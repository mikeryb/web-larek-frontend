# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс отвечает за хранение данных карточек товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- cards: ICard[] - массив объектов карточек товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- _preview: ICard - экземпляр карты, выбранный для показа в модальном окне превью

Так же класс предоставляет сеттеры и геттеры для взаимодействия с этими данными


#### Класс CartData
Класс отвечает за хранение и логику работы с карточками товаров, находящихся в корзине.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- cards: ICard[] - массив объектов карточек товаров, находящихся в корзине
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- toggleCard(card: ICard): void - добавляет, либо удаляет товар с корзины, если он там уже есть
-	clearCart(): void - удаляет все товары с корзины
-	getCards(): ICard[] - возвращает массив объектов карточек товаров, находящихся в корзине
- calculateAmount(): number - возвращает общую сумму заказа
- calculateCount(): number - возвращает количество товаров, находящихся в корзине
- isInCart(card: ICard): boolean - проверяет, есть ли этот товар в корзине

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными пользователя, необходимыми для совершения заказа.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: string - способ оплаты
-	email: string - почта клиента
-	phone: string - телефон клиента
-	adress: string - адрес для доставки
-	total: number - общая сумма заказа
-	items: string[] - массив с объектами заказанных товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setDeliveryInfo(deliveryInfo: DeliveryInfo): void - сохраняет данные по доставке(способ оплаты, адрес)
 - setClientInfo(clientInfo: ClientInfo): void - сохраняет контактные данные клиента(телефон, email)
 - clearInfo(): void - удаляет данные заказа
А также сеттеры и геттеры

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- content: HTMLElement - элемент для заполнения модального окна
- closeBtn: HTMLButtonElement - кнопка закрытия модального окна
- container: HTMLElement - шаблон верстки модального окна
- events: IEvents - брокер событий

Методы класса:
- set content( value: HTMLElement ): void - вставляет нужный контент в шаблон модального окна 

#### Класс CardCatalog
Класс отвечает за отображение карточки товара в галерее главной страницы. В конструктор принимает template-шаблон.

Поля класса

  - element: HTMLElement - шаблон верстки
	- button: HTMLButtonElement - кнопка(сам элемент) для открытия превью
	- category: HTMLElement - категория товара, для добавления класса категории

Методы класса:

static createList(cards: ICard[], template: HTMLTemplateElement, events: EventEmitter): HTMLElement[] - создает массив элементов экземпляров класса  для дальнейшего вставления их в разметку галереи

### Класс CardPreview
Класс отвечает за отображение превью карточки

Поля класса

- element: HTMLElement - шаблон верстки;
- button: HTMLButtonElement - кнопка добавления/удаления карточки в корзину
- inCart: boolean - определяет находится ли карточка в корзине
- category: HTMLElement - категория товара, для добавления класса категории
- image: HTMLImageElement - элемент верстки картинки товара
- title: HTMLElement - элемент верстки названия товара
- price: HTMLElement - элемент верстки цены товара
- description: HTMLElement - элемент верстки описания товара
- private card: ICard - данные карточки товара

Методы класса:

	updateButton(): void - меняет текст кнопки

	set InCart(value: boolean) - меняет поле наличия в корзине и вызывает метод updateButton() для изменения текста

	render(card:ICard) - рендерит экземпляр класса с заполненными данными товара

### Класс CardBasket
Класс отвечает за отображение карточки, находящейся в корзине

Поля класса

- element: HTMLElement - шаблон верстки
- button: HTMLButtonElement - кнопка удаления товара из корзины
- counter: HTMLElement - порядковый номер товара в корзине

Методы класса:

	static createList(cards: ICard[],	template: HTMLTemplateElement, events: EventEmitter): HTMLElement[] - создает массив элементов экземпляров класса  для дальнейшего вставления их в разметку корзины

	setIndex(index: number) - вставляет номер товара в верстку




#### Класс ModalCart
Класс отвечает за отображение разметки корзины в модальном окне. В конструктор принимает template-шаблон. 

Поля класса

- list: HTMLElement - контейнер, который будет заполняться карточками товара, добавленными в корзину
- total: HTMLElement - элемент с счетчиком общей суммы покупок
- button: HTMLElement - кнопка оформления заказа
- items: HTMLElement[] - массив карточек товара, добавленных в корзину
- container: HTMLElement - верстка экземпляра класса

Методы класса:

- set total(total: string) - устанавливает цифру общей суммы заказа

- set goods( items: HTMLElement[] ): void - вставляет в контейнер массив товаров добавленных в корзину, либо надпись 'Корзина пуста'

- setValid( isValid: boolean ): void - изменяет активность кнопки подтверждения 

- render - рендерит верстку корзины вместе с добавленными товарами

#### Класс ModalOrder
Класс отвечает за отображение в модальном окне разметки формы для заполнения данных по оплате и доставке. В конструктор принимает template-шаблон.

Поля класса

- element: HTMLFormElement - шаблон верстки
- buttonCard - кнопка оплаты онлайн
- buttonCash - кнопка оплаты при получении
- fieldAdress - поле адреса
- submitBtn - поле сабмита формы
- errorMessage - поле ошибки заполнения

Методы класса:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения 
- showErrors(isValid: boolean): void - выводит ошибку, если поля не заполнены
- setActive (button: HTMLElement): void - делает кнопку способа оплаты активной
- setInactive (button: HTMLElement): void - делает кнопку способа оплаты неактивной
- getPaymentMethod(): string | null - получает значение выбранного метода оплаты


#### Класс ModalContacts
Класс отвечает за отображение в модальном окне разметки формы для заполнения данных по контактам клиента. В конструктор принимает template-шаблон.

Поля класса

- element: HTMLFormElement - шаблон верстки
- fieldEmail - поле для заполнения почты
- filedPhone - поле для заполнения телефона
- submitBtn - поле сабмита формы
- errorMessage - поле ошибки заполнения

Методы класса:


- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- showErrors(isValid: boolean): void - выводит ошибку, если поля не заполнены


#### Класс ModalSuccess
Класс отвечает за отображение в модальном окне разметки темплейта успешного заказа. В конструктор принимает template-шаблон.

Поля класса

- element: HTMLElement - шаблон верстки
- total - поле с общей суммой заказа
- submitBtn - кнопка сабмита

Методы класса

- setTotal(amount: number): void - вставляет в  верстку текст с общей суммой заказа

#### Класс MainPage
Отвечает за отображение элементов на главной странице

Поля класса

- wrapper: HTMLElement - основная верстка страницы
- _catalog: HTMLElement - контейнер для карточек товара
- cart: HTMLElement - кнопка корзины
- cartCounter: HTMLElement - счетчик корзины


Методы класса

- set counter( value:number ): void - устанавливает счетчик корзины
- set catalog( items: HTMLElement[] ): void - заполняет контейнер массивом карточек



### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие между слоем представления и моделью данных, находится в файле index.ts, который выполняет роль презентера.

Взаимодействие реализовано с помощью событийной системы, основанной на использовании брокера событий EventEmitter. Компоненты представления генерируют события, на которые index.ts подписан. В ответ на события вызываются методы модели, которые, в свою очередь, тоже могут инициировать события об изменении данных. Таким образом, обеспечивается двусторонняя связь без жёсткой зависимости между слоями.

Список всех событий, которые могут генерироваться в системе:

События класса `CardsData`

- `cards:changed` - изменение массива карточек. Событие происходит при загрузке данных из API
- `preview:changed` - изменение открываемой в модальном окне карточки товара. Событие происходит при выборе товара для предпросмотра

События класса `CardCatalog`

- `card:preview` - возникает при нажатии на карточку товара(открытие карточки в модальном окне)

События класса `CartData`

- `cart:changed` - возникает при любом изменении состава корзины

События класса `MainPage`

- `cart:open` - возникает при нажатии на кнопку корзины на главной странице

События класса `Modal` 

- `modal:open` - возникает при открытии модального окна
- `modal:close` - возникает при закрытии модального окна

События класса `CardPreview`

- `card:toggle` - возникает при добавлении/удалении товара в корзину. Также возникает при удаленн товара из корзины в классе ModalCart

События класса `ModalCart`

- `card:toggle` - возникает при удалении товара из корзины
- `order:open` - возникает при сабмите заказа в корзине

События класса `ModalOrder`

- `order:changed` - возникает при сабмите в форме адресных данных
- `order:input` - возникает при любом вводе в форме адресных данных

События класса `OrderData`

- `contacts:open` - возникает при установке адресных данных
- `order:send` - возникает при установке контактных данных

События класса `ModalContacts`

- `contacts:input` - возникает при вводе в поля формы
- `contacts:submit` - возникает при сабмите в форме

События класса `ModalOrder`

- `order:input` - возникает при вводе в поле формы
- `order:submit` - возникает при сабмите формы




В index.ts:

- создаются экземпляры всех необходимых компонентов (моделей и представлений)

- настраиваются подписки на события от компонентов

- реализуется логика обработки этих событий

Пример взаимодействия: Обновление счётчика корзины

- Пользователь нажимает кнопку «В корзину» в карточке товара (CardPreviw)

- Компонент генерирует событие card.toggle, передавая объект товара

- CartData обновляет список товаров и инициирует событие cart:changed

- Обработчик в index.ts вызывает метод setCounter у MainPage, передавая новое значение

- MainPage обновляет DOM-элемент .header__basket-counter
